default_platform(:ios)

opt_out_usage # Ù„Ùˆ Ø¹Ø§ÙŠØ² ØªÙˆÙ‚Ù Ø¥Ø±Ø³Ø§Ù„ ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…

platform :ios do
  desc "Build and upload app to TestApp.io"
  lane :beta do
    # Ø¬Ù„Ø¨ Ø´Ù‡Ø§Ø¯Ø§Øª Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ ÙˆØ¨Ø±ÙˆÙØ§ÙŠÙ„Ø§Øª Ø§Ù„ØªÙˆØ²ÙŠØ¹
    match(
      type: "adhoc",
      readonly: false,
      app_identifier: "com.benhamid.TestCiApp"
    )

    # Ø¨Ù†Ø§Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    build_app(
      scheme: "TestCiApp",              # ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù‡Ø°Ø§ Ø§Ù„Ù€ scheme ÙÙŠ Xcode
      export_method: "ad-hoc",          # Ù„Ø§Ø²Ù… ØªÙƒÙˆÙ† "ad-hoc" Ù…Ø´ "adhoc"
      export_options: {
        provisioningProfiles: {
          "com.benhamid.TestCiApp" => "match AdHoc com.benhamid.TestCiApp"
        }
      }
    )

    # Ø±ÙØ¹ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ TestApp.io
    upload_to_testappio(
      api_token: ENV["TESTAPPIO_API_TOKEN"],
      release_notes: "Uploaded from GitHub Actions ğŸš€"
    )
  end
end

