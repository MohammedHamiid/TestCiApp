default_platform(:ios)

platform :ios do
  desc "Build and upload to TestApp.io"
  lane :beta do
    gym(
      scheme: "TestCiApp",         # âœ… Replace with your actual Xcode scheme
      export_method: "ad-hoc",          # or "app-store" if you're using that
      clean: true
    )

    ipa_path = Actions.lane_context[SharedValues::IPA_OUTPUT_PATH]

    sh "curl -X POST https://upload.testapp.io \
        -H 'Authorization: Bearer #{ENV['TESTAPPIO_API_TOKEN']}' \
        -F 'file=@#{ipa_path}' \
        -F 'release_notes=Uploaded from GitHub Actions CI'"
  end
end
