default_platform(:ios)

opt_out_usage # لو عايز توقف إرسال تحليلات الاستخدام

platform :ios do
  desc "Build and upload app to TestApp.io"
  lane :beta do
    # جلب شهادات التوقيع وبروفايلات التوزيع
    match(
      type: "adhoc",
      readonly: false,
      app_identifier: "com.benhamid.TestCiApp"
    )

    # بناء التطبيق
    build_app(
      scheme: "TestCiApp",              # تأكد من وجود هذا الـ scheme في Xcode
      export_method: "ad-hoc",          # لازم تكون "ad-hoc" مش "adhoc"
      export_options: {
        provisioningProfiles: {
          "com.benhamid.TestCiApp" => "match AdHoc com.benhamid.TestCiApp"
        }
      }
    )

    # رفع التطبيق على TestApp.io
    upload_to_testappio(
      api_token: ENV["TESTAPPIO_API_TOKEN"],
      release_notes: "Uploaded from GitHub Actions 🚀"
    )
  end
end

